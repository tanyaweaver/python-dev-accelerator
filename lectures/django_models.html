<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Django: Model Basics &mdash; Python Dev Accelerator 2.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Python Dev Accelerator 2.0 documentation" href="../index.html" />
    <link rel="up" title="Tuesday" href="../schedule/week06/tue.html" />
    <link rel="next" title="Wednesday" href="../schedule/week06/wed.html" />
    <link rel="prev" title="A Python Miscellany: Iterators &amp; Generators" href="intro_to_python_9_generators.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body role="document">
<div class="header">
  <div class="logo">
    <a href="../index.html">
      <img class="logo" src="../_static/cf_logo.png" alt="Logo"/>
      <p>Code Fellows</p>
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../schedule/week06/wed.html" title="Wednesday"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="intro_to_python_9_generators.html" title="A Python Miscellany: Iterators &amp; Generators"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Python Dev Accelerator 2.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../schedule/week06/tue.html" accesskey="U">Tuesday</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput > div,
div.nbinput div[class^=highlight],
div.nbinput div[class^=highlight] pre,
div.nboutput,
div.nboutput > div,
div.nboutput div[class^=highlight],
div.nboutput div[class^=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput > :first-child pre {
    color: navy;
}

/* output prompt */
div.nboutput > :first-child pre {
    color: darkred;
}

/* all prompts */
div.nbinput > :first-child[class^=highlight],
div.nboutput > :first-child[class^=highlight],
div.nboutput > :first-child {
    min-width: 11ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}

/* input/output area */
div.nbinput > :nth-child(2)[class^=highlight],
div.nboutput > :nth-child(2),
div.nboutput > :nth-child(2)[class^=highlight] {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
}

/* input area */
div.nbinput > :nth-child(2)[class^=highlight] {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput  > :nth-child(2).stderr {
    background: #fdd;
}

/* ANSI colors */
.ansiblack { color: black; }
.ansired { color: darkred; }
.ansigreen { color: darkgreen; }
.ansiyellow { color: #c4a000; }
.ansiblue { color: darkblue; }
.ansipurple { color: darkviolet; }
.ansicyan { color: steelblue; }
/* See https://github.com/jupyter/nbconvert/issues/174 */
.ansigray { color: gray; }  /* nbconvert CSS */
.ansigrey { color: gray; }  /* nbconvert HTML output */

.ansibgblack { background-color: black; }
.ansibgred { background-color: red; }
.ansibggreen { background-color: green; }
.ansibgyellow { background-color: yellow; }
.ansibgblue { background-color: blue; }
.ansibgpurple { background-color: magenta; }
.ansibgcyan { background-color: cyan; }
.ansibggray { background-color: gray; }

.ansibold { font-weight: bold; }
</style>
<div class="section" id="django-model-basics">
<h1>Django: Model Basics<a class="headerlink" href="#django-model-basics" title="Permalink to this headline">¶</a></h1>
<p>We&#8217;ve now spent some time getting to know how to write web applications using the Pyramid framework.
We&#8217;ve learned the basics of Model construction, routing, views and renderers.
We&#8217;ve learned how to authenticate users and how to authorize them to take certain actions.
And we&#8217;ve created our own first projects using this powerful and flexible tool.</p>
<p>Now it&#8217;s time for us to move on to using the current undisputed champion of the Python web frameworks: <a class="reference external" href="https://www.djangoproject.com/">Django</a></p>
<div class="section" id="starting-a-django-project">
<h2>Starting a Django Project<a class="headerlink" href="#starting-a-django-project" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;ll begin by creating a new virtualenv in which to play.
This one is temporary, just for exploring in class.
Name it accoringly, and then install Django:</p>
<div class="left highlight-bash"><div class="highlight"><pre>$ python3 -m venv djplay
...
$ <span class="nb">cd</span> djplay
$ <span class="nb">source</span> bin/activate
<span class="o">(</span>djplay<span class="o">)</span>$ pip install Django
Downloading/unpacking Django
  Downloading Django-1.9.5-py2.py3-none-any.whl <span class="o">(</span>6.6MB<span class="o">)</span>: 6.6MB downloaded
Installing collected packages: Django
Successfully installed Django
Cleaning up...
</pre></div>
</div>
<div class="section" id="startproject">
<h3><code class="docutils literal"><span class="pre">startproject</span></code><a class="headerlink" href="#startproject" title="Permalink to this headline">¶</a></h3>
<p>Once Django is installed, we can create a &#8220;project&#8221; to explore a bit.
Django uses the term &#8220;project&#8221; to refer to the code that will make up one website.
You always begin work on a Django website by creating a project.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>djplay<span class="o">)</span>$ django-admin startproject foo
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">startproject</span></code> command works a bit like the <code class="docutils literal"><span class="pre">pcreate</span></code> command in Pyramid.
It creates a bit of boilerplate code structure to make starting a new site easier.
Let&#8217;s take a moment to look over the <code class="docutils literal"><span class="pre">foo</span></code> directory it created.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>djplay<span class="o">)</span>$ tree foo
foo
├── foo
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
└── manage.py
</pre></div>
</div>
<p>Notice it creates both an <em>outer</em> foo folder and an <em>inner</em> foo folder.
The outer one is your <em>project home</em> (or <em>project root</em>).
You should consider the contents of this outer folder the root of the project repository.</p>
<p>Nested inside the <em>project root</em> is a folder we&#8217;ll call the <em>configuration root</em>.
This folder <strong>must</strong> be a proper Python package (with an <code class="docutils literal"><span class="pre">__init__.py</span></code> file).</p>
<p>It contains your project settings file(s) <code class="docutils literal"><span class="pre">settings.py</span></code>.
This file contains configuration settings for a project.
It plays a role similar to the <code class="docutils literal"><span class="pre">development/production.ini</span></code> files we&#8217;ve seen in Pyramid.</p>
<p>It also contains a <code class="docutils literal"><span class="pre">wsgi.py</span></code> file, which exposes the wsgi application that contains your project.
This file is roughly analagous to the <code class="docutils literal"><span class="pre">paste.app_factory</span></code> entry point in a Pyramid application.
However, Django is not as closely tied to Python packaging as Pyramid.
It makes much less use of packaging features like entry points, in favor of its own solutions.</p>
<p>Finally, the configuration root contains a <code class="docutils literal"><span class="pre">urls.py</span></code> file.
This file contains the top-level configuration of urls for your project.
We&#8217;ll talk more about this next week, but for now, understand that Django urls are analogous to Pyramid&#8217;s <em>routes</em>.
They provide the connection between the <em>path</em> of an incoming HTTP request and the code object that will generate an HTTP response.</p>
</div>
<div class="section" id="manage-py">
<h3><code class="docutils literal"><span class="pre">manage.py</span></code><a class="headerlink" href="#manage-py" title="Permalink to this headline">¶</a></h3>
<p>The only other file created by <code class="docutils literal"><span class="pre">startproject</span></code> is <code class="docutils literal"><span class="pre">manage.py</span></code>, in the <em>project root</em>.
The file contains code which locates your project&#8217;s <code class="docutils literal"><span class="pre">settings.py</span></code> file.
It does this by setting the value of <code class="docutils literal"><span class="pre">DJANGO_SETTINGS_MODULE</span></code> in <code class="docutils literal"><span class="pre">os.environ</span></code>.</p>
<p>This file serves as a gateway to Django&#8217;s command system.
It is an executable python script (notice the <code class="docutils literal"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;:</span></code> block and the <em>shebang</em> line at the top).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;foo.settings&quot;</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">django.core.management</span> <span class="kn">import</span> <span class="n">execute_from_command_line</span>

    <span class="n">execute_from_command_line</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="managing-django">
<h2>Managing Django<a class="headerlink" href="#managing-django" title="Permalink to this headline">¶</a></h2>
<p>Django&#8217;s management command system is accessed entirely through the <code class="docutils literal"><span class="pre">manage.py</span></code> script.
When we execute this script, it uses additional values on the command line as command names and arguments for those commands.
To get a list of the available management commands, run the script with no additional values:</p>
<div class="left highlight-bash"><div class="highlight"><pre><span class="o">(</span>djplay<span class="o">)</span>$ <span class="nb">cd</span> foo
<span class="o">(</span>djplay<span class="o">)</span>$ python manage.py

Type <span class="s1">&#39;manage.py help &lt;subcommand&gt;&#39;</span> <span class="k">for</span> <span class="nb">help</span> on a specific subcommand.

Available subcommands:

<span class="o">[</span>auth<span class="o">]</span>
    changepassword
    createsuperuser
    ...
</pre></div>
</div>
<div class="section" id="shell">
<h3><code class="docutils literal"><span class="pre">shell</span></code><a class="headerlink" href="#shell" title="Permalink to this headline">¶</a></h3>
<p>The first command that will be important to you is <code class="docutils literal"><span class="pre">shell</span></code>.
Running this command starts an interactive Python session with all of the packages in your Django project available for import.
It&#8217;s the Django version of <code class="docutils literal"><span class="pre">pshell</span></code> from Pyramid.
And like <code class="docutils literal"><span class="pre">pshell</span></code>, if you install iPython, it will automatically use the iPython interpreter (with tab completion and everything):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>djplay<span class="o">)</span>$ pip install iPython
...
<span class="o">(</span>djplay<span class="o">)</span>$ python manage.py shell
Python 3.5.1 <span class="o">(</span>default, Jan <span class="m">18</span> 2016, 14:50:30<span class="o">)</span>
...
In <span class="o">[</span>1<span class="o">]</span>: import django.contrib.auth
In <span class="o">[</span>2<span class="o">]</span>: django.contrib.auth.
django.contrib.auth.BACKEND_SESSION_KEY
django.contrib.auth.HASH_SESSION_KEY
...
</pre></div>
</div>
</div>
</div>
<div class="section" id="exploring-django-s-models">
<h2>Exploring Django&#8217;s Models<a class="headerlink" href="#exploring-django-s-models" title="Permalink to this headline">¶</a></h2>
<p>Django comes with its own ORM, and relies entirely on the idea of <em>models</em>.
It comes with quite a few of these models already present.
Django <em>requires</em> that you place models in a Python module named <code class="docutils literal"><span class="pre">models.py</span></code>.
We can use this knowledge to explore the models from Django&#8217;s <code class="docutils literal"><span class="pre">auth</span></code> app.
Here we will find the <code class="docutils literal"><span class="pre">User</span></code> model, the core of Django&#8217;s authentication and authorization systems.</p>
<div class="left highlight-ipython"><div class="highlight"><pre><span class="gp">In [2]: </span><span class="n">django</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">models</span><span class="o">.</span>
<span class="go">django.contrib.auth.models.AbstractBaseUser</span>
<span class="go">django.contrib.auth.models.AbstractUser</span>
<span class="go">...</span>
<span class="go">django.contrib.auth.models.User</span>
<span class="go">...</span>
</pre></div>
</div>
<div class="section" id="user">
<h3>User<a class="headerlink" href="#user" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s import and inspect the User model, so we can learn a bit about it.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [2]: </span><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="gp">In [3]: </span>User<span class="o">?</span>
<span class="go">Init signature: User(self, *args, **kwargs)</span>
<span class="go">Docstring:</span>
<span class="go">Users within the Django authentication system are represented by this</span>
<span class="go">model.</span>

<span class="go">Username, password and email are required. Other fields are optional.</span>
<span class="go">File:           ~/.virtualenvs/d35-imager/lib/python2.7/site-packages/django/contrib/auth/models.py</span>
<span class="go">Type:           ModelBase</span>
</pre></div>
</div>
<p>So the <code class="docutils literal"><span class="pre">User</span></code> model has username, password and email.
These are required attributes.
But what else is there?</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [4]: </span><span class="nb">dir</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
<span class="gh">Out[4]:</span>
<span class="go">[&#39;DoesNotExist&#39;,</span>
<span class="go">&#39;Meta&#39;,</span>
<span class="go">&#39;MultipleObjectsReturned&#39;,</span>
<span class="go">&#39;REQUIRED_FIELDS&#39;,</span>
<span class="go">&#39;USERNAME_FIELD&#39;,</span>
<span class="go">...</span>
</pre></div>
</div>
<p>Wow, there&#8217;s all sorts of stuff on that object!
It might be better for us to go and take a look at the source code so we can start to get an idea of how this thing is built.
Lets see where the <cite>User</cite> file lives:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [5]: </span><span class="n">django</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">__file__</span>
<span class="gh">Out[5]: </span><span class="go">&#39;.../djplay/lib/python2.7/site-packages/django/contrib/auth/models.pyc&#39;</span>
</pre></div>
</div>
<p>Reading the source file, we can find the <code class="docutils literal"><span class="pre">User</span></code> model.
But the source for it is remarkably void of attributes.
Where do all the attributes we saw in the shell come from?</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Users within the Django authentication system are represented by this</span>
<span class="sd">    model.</span>

<span class="sd">    Username, password and email are required. Other fields are optional.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">AbstractUser</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">swappable</span> <span class="o">=</span> <span class="s1">&#39;AUTH_USER_MODEL&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="subclassing">
<h3>Subclassing<a class="headerlink" href="#subclassing" title="Permalink to this headline">¶</a></h3>
<p>Django makes extensive use of <em>subclassing</em> to share attributes among models.
The <code class="docutils literal"><span class="pre">User</span></code> model inherits from <code class="docutils literal"><span class="pre">AbstractUser</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AbstractUser</span><span class="p">(</span><span class="n">AbstractBaseUser</span><span class="p">,</span> <span class="n">PermissionsMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">_</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">),</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Required. 30 characters or fewer. Letters, digits and @/./+/-/_ only.&#39;</span><span class="p">)</span>
        <span class="o">...</span>
        <span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="fields">
<h3>Fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">AbstractUser</span></code> inherits from <code class="docutils literal"><span class="pre">AbstractBaseUser</span></code> and <code class="docutils literal"><span class="pre">PermissionsMixin</span></code> too, but here we can see <code class="docutils literal"><span class="pre">username</span></code>.
Notice the syntax used to define that attribute.
It looks similar to SQLAlchemy, in that the attribute is bound to an instance of some kind of class.</p>
<p>In SQLAlchemy we called these things <code class="docutils literal"><span class="pre">Columns</span></code>.
In Django, we call them <code class="docutils literal"><span class="pre">Fields</span></code>.
It can get confusing because there are Model fields and Form fields, but they are not the same thing.</p>
<p>This <code class="docutils literal"><span class="pre">username</span></code> is a <em>model field</em>.
Like SQLAlchemy <code class="docutils literal"><span class="pre">Columns</span></code>, model fields are responsible for communicating between Python and the database.
The <cite>models.CharField</cite> defines a text field inside the database.
Values we set for this attribute of instances of the <code class="docutils literal"><span class="pre">User</span></code> model
We can create a new <code class="docutils literal"><span class="pre">User</span></code> instance.
We can set a value for the <cite>username</cite> attribute on that instance.
And we can persist that value into a database.</p>
<p>The biggest difference here from what we are used to has to do with the <em>semantics</em> of how we interact with the database.
Django is <code class="docutils literal"><span class="pre">model</span></code>-centric as opposed to <code class="docutils literal"><span class="pre">session</span></code>-centric.
Remember in SQLAlchemy we always started with a <code class="docutils literal"><span class="pre">session</span></code>.
We would use statements like <code class="docutils literal"><span class="pre">session.query(Entry)</span></code> to query a model.</p>
<p>Django is different.
We start with the model itself, <code class="docutils literal"><span class="pre">User</span></code>.
That class object will have an attribute called <code class="docutils literal"><span class="pre">objects</span></code>.
That attribute <em>is</em> the connection between the model class and the database.
We will use that attribute to build queries.</p>
<p>Let&#8217;s create a new user <cite>bob</cite>:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [2]: </span><span class="n">bob</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
<span class="gp">In [3]: </span><span class="n">bob</span>
<span class="gh">Out[3]: </span><span class="go">&lt;User: &gt;</span>
</pre></div>
</div>
<p>By default, <code class="docutils literal"><span class="pre">bob</span></code> has empty attributes:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [4]: </span><span class="n">bob</span><span class="o">.</span><span class="n">username</span>
<span class="gh">Out[4]: </span><span class="go">u&#39;&#39;</span>
<span class="gp">In [5]: </span><span class="n">bob</span><span class="o">.</span><span class="n">email</span>
<span class="gh">Out[5]: </span><span class="go">u&#39;&#39;</span>
<span class="gp">In [6]: </span><span class="k">print</span><span class="p">(</span><span class="n">bob</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="go">None</span>
</pre></div>
</div>
<p>Let&#8217;s give bob some information.
We saw before that <cite>username</cite>, <cite>password</cite>, and <cite>email</cite> are required.
We&#8217;ll start by setting values for those attributes.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [7]: </span><span class="n">bob</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;bob&quot;</span>
<span class="gp">In [8]: </span><span class="n">bob</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;foobar&quot;</span>
<span class="gp">In [9]: </span><span class="n">bob</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s2">&quot;bob@bob_dobalina.com&quot;</span>
<span class="gp">In [10]: </span><span class="n">bob</span>
<span class="gh">Out[10]: </span><span class="go">&lt;User: bob&gt;</span>
</pre></div>
</div>
<p>Now we have <code class="docutils literal"><span class="pre">bob</span></code> with a representation: <code class="docutils literal"><span class="pre">&lt;User:</span> <span class="pre">bob&gt;</span></code>.
Does bob have an ID now?</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [11]: </span><span class="n">bob</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<p>No.
Nothing is returned.
How did we add a new entry into our system in Pyramid?
How did we make the database aware of something and preserve it?</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</pre></div>
</div>
<p>But not in Django.
Remember, here the semantics are based on the instance itself.
We can call <code class="docutils literal"><span class="pre">save</span></code> on the <code class="docutils literal"><span class="pre">bob</span></code> user instance.
But we have to create the database first.</p>
<p>In another terminal, create our database tables:</p>
<div class="highlight-bash"><div class="highlight"><pre>$ <span class="nb">source</span> bin/activate
<span class="o">(</span>djenv<span class="o">)</span>$ python manage.py migrate
Operations to perform:
  Apply all migrations: admin, contenttypes, auth, sessions
Running migrations:
  Rendering model states... DONE
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  ...
</pre></div>
</div>
</div>
<div class="section" id="basic-query-api">
<h3>Basic Query API<a class="headerlink" href="#basic-query-api" title="Permalink to this headline">¶</a></h3>
<p>Now we can save <code class="docutils literal"><span class="pre">bob</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">bob</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">bob</span><span class="o">.</span><span class="n">id</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>And make even more users:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">sally</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;sally&quot;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s2">&quot;sally@sally.com&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;secret&quot;</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">sally</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">sally</span><span class="o">.</span><span class="n">id</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="mi">2</span>
</pre></div>
</div>
<p>How about a list of all of our users?</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">User</span><span class="p">:</span> <span class="n">bob</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">User</span><span class="p">:</span> <span class="n">sally</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p>We can filter the list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;bob&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">User</span><span class="p">:</span> <span class="n">bob</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="for-homework">
<h2>For Homework<a class="headerlink" href="#for-homework" title="Permalink to this headline">¶</a></h2>
<p>One of the first things we want to do is create a user model.
Something that represents the user in our system.
However, we are strongly encourged to use Django&#8217;s own built in user model unless we have a very good reason not to.
But the standard Django user model doesn&#8217;t have everything that we want. It does have:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AbstractUser</span><span class="p">(</span><span class="n">AbstractBaseUser</span><span class="p">,</span> <span class="n">PermissionsMixin</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;first name&#39;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;last name&#39;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;email address&#39;</span><span class="p">),</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">is_staff</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">_</span><span class="p">(</span><span class="s1">&#39;staff status&#39;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Designates whether the user can log into this admin site.&#39;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">is_active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">_</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span>
            <span class="s1">&#39;Designates whether this user should be treated as active. &#39;</span>
            <span class="s1">&#39;Unselect this instead of deleting accounts.&#39;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">date_joined</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;date joined&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="left container">
<p>We also get a few fields from <code class="docutils literal"><span class="pre">AbstractBaseUser</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AbstractBaseUser</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">last_login</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;last login&#39;</span><span class="p">),</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">is_active</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="our-needs">
<h3>Our Needs<a class="headerlink" href="#our-needs" title="Permalink to this headline">¶</a></h3>
<p>Our application will allow users to store and organize photos.
We might want to have information about our users related to that purpose.
Values like:</p>
<ul class="simple">
<li>What kind of camera they have</li>
<li>Address</li>
<li>Link to a personal website</li>
<li>Type of photography (nature, urban, portrats?)</li>
<li>Social media keys</li>
</ul>
<p>The Django way of customizing a user is not to change the Django user model.
You can do that, but you may break many things if you do that.
Django wants you to move all of the other things into a <cite>profile</cite>.</p>
<p>We&#8217;ll need to create a new model of our own, a <code class="docutils literal"><span class="pre">UserProfile</span></code>.
Any given user will only need to have one profile.
And any given profile will belong only to one user.
The SQL relationship that represents this is called <code class="docutils literal"><span class="pre">One</span> <span class="pre">to</span> <span class="pre">One</span></code>.
It&#8217;s represented in SQL by a foreign key combined with a unique constraint.</p>
<p>In Django, there is a <a class="reference external" href="https://docs.djangoproject.com/en/1.9/ref/models/fields/#django.db.models.ForeignKey">ForeignKey</a> field.
It takes as its first argument the class to which you want to build a relationship.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">profile</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>But this is the old-fashioned way to do it.
If we look at a profile object, and we want to find the user to which it is related, we say <code class="docutils literal"><span class="pre">bob_profile.user</span></code>.
We&#8217;d like the result of this call to be a user instance.
If we use a <code class="docutils literal"><span class="pre">ForeignKey</span></code> with <code class="docutils literal"><span class="pre">unique=True</span></code>, we&#8217;ll get a list back that <em>contains</em> the user.
Django also supplies a <code class="docutils literal"><span class="pre">OneToOneField</span></code>.
Using this will allow Django to expect&#8211;and return&#8211;only one value.</p>
<p>You&#8217;ll need to create an app to hold this profile.
Use what you learned from the Django tutorial to accomplish this task.</p>
</div>
</div>
<div class="section" id="wrap-up">
<h2>Wrap Up<a class="headerlink" href="#wrap-up" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;ve learned a bit now about how Django works.
We learned about starting new applications, and managing them.
We&#8217;ve learned about the Django ORM and how it works
And we&#8217;ve learned about the built-in User model it provides.
We&#8217;ve talked about how we can extend the functionality of this model using a <code class="docutils literal"><span class="pre">Profile</span></code> related to the User by a one-to-one relationship.
You&#8217;ll use this knowledge now to create a profile for the users of our Django Imager application.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Django: Model Basics</a><ul>
<li><a class="reference internal" href="#starting-a-django-project">Starting a Django Project</a><ul>
<li><a class="reference internal" href="#startproject"><code class="docutils literal"><span class="pre">startproject</span></code></a></li>
<li><a class="reference internal" href="#manage-py"><code class="docutils literal"><span class="pre">manage.py</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#managing-django">Managing Django</a><ul>
<li><a class="reference internal" href="#shell"><code class="docutils literal"><span class="pre">shell</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#exploring-django-s-models">Exploring Django&#8217;s Models</a><ul>
<li><a class="reference internal" href="#user">User</a></li>
<li><a class="reference internal" href="#subclassing">Subclassing</a></li>
<li><a class="reference internal" href="#fields">Fields</a></li>
<li><a class="reference internal" href="#basic-query-api">Basic Query API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#for-homework">For Homework</a><ul>
<li><a class="reference internal" href="#our-needs">Our Needs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wrap-up">Wrap Up</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="intro_to_python_9_generators.html"
                        title="previous chapter">A Python Miscellany: Iterators &amp; Generators</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../schedule/week06/wed.html"
                        title="next chapter">Wednesday</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../schedule/week06/wed.html" title="Wednesday"
             >next</a> |</li>
        <li class="right" >
          <a href="intro_to_python_9_generators.html" title="A Python Miscellany: Iterators &amp; Generators"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Python Dev Accelerator 2.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../schedule/week06/tue.html" >Tuesday</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Cris Ewing.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
    </div>
  </body>
</html>