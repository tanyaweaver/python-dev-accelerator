<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Extracting Data from the Web, II &mdash; Python Dev Accelerator 2.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Python Dev Accelerator 2.0 documentation" href="../index.html" />
    <link rel="up" title="401 Python: Lecture Notes" href="index.html" />
    <link rel="next" title="Behavior Driven Development with Lettuce" href="lettuce.html" />
    <link rel="prev" title="Automate Tests with Travis CI" href="jenkins.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body role="document">
<div class="header">
  <div class="logo">
    <a href="../index.html">
      <img class="logo" src="../_static/cf_logo.png" alt="Logo"/>
      <p>Code Fellows</p>
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="lettuce.html" title="Behavior Driven Development with Lettuce"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="jenkins.html" title="Automate Tests with Travis CI"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Python Dev Accelerator 2.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">401 Python: Lecture Notes</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput > div,
div.nbinput div[class^=highlight],
div.nbinput div[class^=highlight] pre,
div.nboutput,
div.nboutput > div,
div.nboutput div[class^=highlight],
div.nboutput div[class^=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput > :first-child pre {
    color: navy;
}

/* output prompt */
div.nboutput > :first-child pre {
    color: darkred;
}

/* all prompts */
div.nbinput > :first-child[class^=highlight],
div.nboutput > :first-child[class^=highlight],
div.nboutput > :first-child {
    min-width: 11ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}

/* input/output area */
div.nbinput > :nth-child(2)[class^=highlight],
div.nboutput > :nth-child(2),
div.nboutput > :nth-child(2)[class^=highlight] {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
}

/* input area */
div.nbinput > :nth-child(2)[class^=highlight] {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput  > :nth-child(2).stderr {
    background: #fdd;
}

/* ANSI colors */
.ansiblack { color: black; }
.ansired { color: darkred; }
.ansigreen { color: darkgreen; }
.ansiyellow { color: #c4a000; }
.ansiblue { color: darkblue; }
.ansipurple { color: darkviolet; }
.ansicyan { color: steelblue; }
/* See https://github.com/jupyter/nbconvert/issues/174 */
.ansigray { color: gray; }  /* nbconvert CSS */
.ansigrey { color: gray; }  /* nbconvert HTML output */

.ansibgblack { background-color: black; }
.ansibgred { background-color: red; }
.ansibggreen { background-color: green; }
.ansibgyellow { background-color: yellow; }
.ansibgblue { background-color: blue; }
.ansibgpurple { background-color: magenta; }
.ansibgcyan { background-color: cyan; }
.ansibggray { background-color: gray; }

.ansibold { font-weight: bold; }
</style>
<div class="section" id="extracting-data-from-the-web-ii">
<h1>Extracting Data from the Web, II<a class="headerlink" href="#extracting-data-from-the-web-ii" title="Permalink to this headline">¶</a></h1>
<div class="left container">
<p>Scraping web pages is tedious and inherently brittle.</p>
<p>If the owner of the website updates their layout, your code breaks.</p>
<p>But there is another way to get information from the web in a more
normalized fashion.</p>
</div>
<div class="section" id="web-services">
<h2>Web Services<a class="headerlink" href="#web-services" title="Permalink to this headline">¶</a></h2>
<div class="left container">
<p>A web service is described by the W3C as:</p>
<div class="highlight-python"><div class="highlight"><pre>&quot;a software system designed to support interoperable machine-to-machine
interaction over a network&quot;
</pre></div>
</div>
<p>In general, a web service provides a defined set of functionality and
returns structured data in response to well-formed requests.</p>
</div>
</div>
<div class="section" id="early-web-services">
<h2>Early Web Services<a class="headerlink" href="#early-web-services" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rss">
<h3>RSS<a class="headerlink" href="#rss" title="Permalink to this headline">¶</a></h3>
<p>RSS is one of the earliest forms of Web Services</p>
<ul class="build simple">
<li>First known as <code class="docutils literal"><span class="pre">RDF</span> <span class="pre">Site</span> <span class="pre">Summary</span></code></li>
<li>Became <code class="docutils literal"><span class="pre">Really</span> <span class="pre">Simple</span> <span class="pre">Syndication</span></code></li>
<li>More at <a class="reference external" href="http://www.rss-specification.com/rss-specifications.htm">http://www.rss-specification.com/rss-specifications.htm</a></li>
</ul>
<div class="build container">
<p>A single web-based <em>endpoint</em> provides a dynamically updated listing of
content</p>
<p>RSS is implemented in pure HTTP.  The return value is an XML document</p>
<p><strong>Atom</strong> is a competing, but similar standard.</p>
</div>
<p>An RSS document might look something like this:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;rss</span> <span class="na">version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;channel&gt;</span>
  <span class="nt">&lt;title&gt;</span>RSS Title<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;description&gt;</span>This is an example of an RSS feed<span class="nt">&lt;/description&gt;</span>
  <span class="nt">&lt;link&gt;</span>http://www.someexamplerssdomain.com/main.html<span class="nt">&lt;/link&gt;</span>
  <span class="nt">&lt;lastBuildDate&gt;</span>Mon, 06 Sep 2010 00:01:00 +0000 <span class="nt">&lt;/lastBuildDate&gt;</span>
  <span class="nt">&lt;pubDate&gt;</span>Mon, 06 Sep 2009 16:45:00 +0000 <span class="nt">&lt;/pubDate&gt;</span>
  <span class="nt">&lt;ttl&gt;</span>1800<span class="nt">&lt;/ttl&gt;</span>

  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;title&gt;</span>Example entry<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;description&gt;</span>Here is some text containing an interesting description.<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;link&gt;</span>http://www.wikipedia.org/<span class="nt">&lt;/link&gt;</span>
    <span class="nt">&lt;guid&gt;</span>unique string per item<span class="nt">&lt;/guid&gt;</span>
    <span class="nt">&lt;pubDate&gt;</span>Mon, 06 Sep 2009 16:45:00 +0000 <span class="nt">&lt;/pubDate&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
  ...
<span class="nt">&lt;/channel&gt;</span>
<span class="nt">&lt;/rss&gt;</span>
</pre></div>
</div>
<p>In python, the best tool for consuming RSS, Atom and other related feeds is
<a class="reference external" href="https://pythonhosted.org/feedparser/">feedparser</a>.  It&#8217;s not part of the standard library, but it is very well
supported and commonly used.</p>
</div>
<div class="section" id="xml-rpc">
<h3>XML-RPC<a class="headerlink" href="#xml-rpc" title="Permalink to this headline">¶</a></h3>
<p>RSS provides a pre-defined data set, can we also allow <em>calling procedures</em> to
get more dynamic data?</p>
<div class="build container">
<p>We can!  Enter XML-RPC (Remote Procedure Call)</p>
<ul class="build simple">
<li>Provides a set of defined procedures which can take arguments</li>
<li>Requests are made via HTTP GET, by passing an XML document</li>
<li>Responses are sent to the client as an XML document</li>
</ul>
</div>
<p>The Python standard library provides modules both for producing <em>and</em> for
consuming XML-RPC services.</p>
<div class="build container">
<p>Services can be built by registering functions or even entire class objects
with the <code class="docutils literal"><span class="pre">SimpleXMLRPCServer</span></code> class from the <a class="reference external" href="http://docs.python.org/2/library/simplexmlrpcserver.html">SimpleXMLRPCServer</a>
library.</p>
<p>The <a class="reference external" href="http://docs.python.org/2/library/xmlrpclib.html">xmlrpclib</a> module provides client methods to consume XML-RPC
services.</p>
<p>It is worth noting that there are a number of <a class="reference external" href="http://docs.python.org/2/library/xml.html#xml-vulnerabilities">known vulnerabilities</a> in
the XML standard and that the <code class="docutils literal"><span class="pre">xmlrpclib</span></code> is <strong>not</strong> secured against
them. When interacting with XML-RPC online, it behooves you to pay close
attention to the sources of your data.</p>
</div>
<p>Though it is much less common to see XML-RPC these days, you can still run into
such services.</p>
<p>You have a <a class="reference internal" href="../assignments/xmlrpc.html#xmlrpc-assignment"><span>brief XML-RPC walkthrough assignment</span></a> that
will help you to familiarize yourself with this form of Web Services.</p>
</div>
<div class="section" id="soap">
<h3>SOAP<a class="headerlink" href="#soap" title="Permalink to this headline">¶</a></h3>
<ul class="build simple">
<li>XML-RPC allows introspection</li>
<li>XML-RPC forces you to introspect to get information</li>
<li><strong>Wouldn&#8217;t it be nice to get that automatically?</strong></li>
<li>XML-RPC provides data types</li>
<li>XML-RPC provides only <em>certain</em> data types</li>
<li><strong>Wouldn&#8217;t it be nice to have an extensible system for types?</strong></li>
<li>XML-RPC allows calling methods with parameters</li>
<li>XML-RPC only allows calling methods, nothing else</li>
<li><strong>wouldn&#8217;t it be nice to have contextual data as well?</strong></li>
</ul>
<p><strong>Enter SOAP: Simple Object Access Protocol</strong></p>
<div class="build container">
<p>SOAP extends XML-RPC in a couple of useful ways:</p>
<ul class="build simple">
<li>It uses the Web Services Description Language (WSDL) to provide meta-data
about an entire service in a machine-readable format (Automatic
introspection)</li>
<li>It establishes a method for extending available data types using XML
namespaces (extensible type system)</li>
<li>It provides a wrapper around method calls called the <strong>envelope</strong>, which
allows the inclusion of a <strong>header</strong> with system meta-data that can be
used by the application (contextual data)</li>
</ul>
</div>
</div>
<div class="section" id="soap-in-python">
<h3>SOAP in Python<a class="headerlink" href="#soap-in-python" title="Permalink to this headline">¶</a></h3>
<p>There is no standard library module that supports SOAP directly.</p>
<ul class="build simple">
<li>The best-known and best-supported module available is <strong>Suds</strong></li>
<li>The homepage is <a class="reference external" href="https://fedorahosted.org/suds/">https://fedorahosted.org/suds/</a></li>
<li>It can be installed using <code class="docutils literal"><span class="pre">easy_install</span></code> or <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span></code></li>
</ul>
<div class="build container">
<p><strong>HOWEVER</strong></p>
<p>The source for <code class="docutils literal"><span class="pre">suds</span></code> has not seen a commit since <a class="reference external" href="https://fedorahosted.org/suds/changeset/712">February 13, 2012</a>,
and the last release of the package to PyPI was <a class="reference external" href="https://pypi.python.org/pypi/suds.">even longer ago, in
2010</a>.</p>
</div>
<p>There <em>is</em> an updated version of this package available. It&#8217;s called
<a class="reference external" href="https://pypi.python.org/pypi/suds-jurko/0.6">suds-jurko</a> after the username of the developer who stepped up to lead
development forward.</p>
<div class="build container">
<p>I cannot speak to the quality of this package, but it does show a lot of
activity, with the most recent commits coming in the last few days, and the
most recent release coming in January 2014.</p>
<p>I&#8217;m not going to bother providing an exercise in SOAP. I&#8217;ve never had an
interaction with a SOAP service that was a positive experience, and if you
have any other option, you should avoid it.</p>
<p>If you do have to use a SOAP web service, prepare yourself for some
significant time spent trying to get things to work properly.</p>
</div>
</div>
<div class="section" id="afterword">
<h3>Afterword<a class="headerlink" href="#afterword" title="Permalink to this headline">¶</a></h3>
<p>SOAP (and XML-RPC) have some issues.</p>
<ul class="simple">
<li>XML is pretty damned inefficient as a data transfer medium</li>
<li>Why should I need to know method names?</li>
<li>If I can discover method names at all, I have to read a WSDL to do it?</li>
</ul>
<p>Moreover, for SOAP <code class="docutils literal"><span class="pre">suds</span></code> is the best we have, and it hasn&#8217;t been updated
since Sept. 2010 by its official owner. What does that say about the utility of
the standard? (At least as perceived by the Python community?)</p>
</div>
</div>
<div class="section" id="modern-web-services">
<h2>Modern Web Services<a class="headerlink" href="#modern-web-services" title="Permalink to this headline">¶</a></h2>
<p class="left">So, if not XML, then what data format <em>should</em> one use to provide responses to
Web Service calls?</p>
<div class="section" id="json">
<h3>JSON<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h3>
<p>JavaScript Object Notation:</p>
<ul class="build simple">
<li>a lightweight data-interchange format</li>
<li>easy for humans to read and write</li>
<li>easy for machines to parse and generate</li>
</ul>
<div class="build container">
<p>JSON is based on two structures:</p>
<ul class="simple">
<li>the JavaScript object: <code class="docutils literal"><span class="pre">{</span> <span class="pre">string:</span> <span class="pre">value,</span> <span class="pre">...}</span></code></li>
<li>the JavaScript array: <code class="docutils literal"><span class="pre">[value,</span> <span class="pre">value,</span> <span class="pre">]</span></code></li>
</ul>
<p>These both end up looking quite suspiciously like code we are familiar with.</p>
</div>
<p>In addition JSON provides a few basic data types (see <a class="reference external" href="http://json.org/">http://json.org/</a>):</p>
<ul class="build simple">
<li><strong>string</strong>: unicode, anything but &#8221;, \ and control characters</li>
<li><strong>number</strong>: any number, but json does not use octal or hexadecimal</li>
<li><strong>object, array</strong>: (we&#8217;ve seen these above)</li>
<li><strong>true</strong>: boolean true value</li>
<li><strong>false</strong>: boolean false value</li>
<li><strong>null</strong>: represents no value, the same as Python&#8217;s <code class="docutils literal"><span class="pre">None</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Boolean values <em>must</em> be typed as all lowercase letters. This is
JavaScript, not Python. It&#8217;s an easy mistake to make.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is no representation of a date type in JSON.</p>
</div>
<p><strong>No date type? OMGWTF??!!1!1</strong></p>
<div class="build container">
<p>You have a couple of options for how to deal with dates and time in JSON.</p>
<div class="container">
<p>Option 1 - Unix Epoch Time (number):</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="go">1358212616.7691269</span>
</pre></div>
</div>
</div>
<div class="container">
<p>Option 2 - ISO 8661 (string):</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<span class="go">&#39;2013-01-14T17:18:10.727240&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="json-in-python">
<h3>JSON in Python<a class="headerlink" href="#json-in-python" title="Permalink to this headline">¶</a></h3>
<p>You can encode Python to json, and decode json back to Python:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;[1, 2, 3]&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">orig</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="s1">u&#39;my resumé&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">encoded</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">orig</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">encoded</span>
<span class="go">&#39;{&quot;baz&quot;: true, &quot;foo&quot;: [1, 2, 3], &quot;bar&quot;: &quot;my resum\\u00e9&quot;}&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">decoded</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">decoded</span> <span class="o">==</span> <span class="n">orig</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Notice that by default, unicode strings are converted to ASCII-compatible
escape characters.</p>
<p>Also note that encoding a Python <code class="docutils literal"><span class="pre">tuple</span></code> to JSON and then decoding it back to
Python <strong>cannot produce a tuple</strong>:</p>
<div class="build container">
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">encoded</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">encoded</span>
<span class="go">&#39;[1, 2, 3]&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bar</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bar</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bar</span> <span class="o">==</span> <span class="n">foo</span>
<span class="go">False</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>This is just the way that it is due to the fact that JavaScript does not have
any data equivalent of the immutable tuple type in Python.</p>
</div>
<p>In addition to <code class="docutils literal"><span class="pre">loads</span></code> and <code class="docutils literal"><span class="pre">dumps</span></code>, json provides <code class="docutils literal"><span class="pre">load</span></code> and <code class="docutils literal"><span class="pre">dump</span></code>.
The difference between these methods is in what argument they accept as the
value to be decoded or encoded.</p>
<p>The <code class="docutils literal"><span class="pre">json.loads</span></code> method takes a <code class="docutils literal"><span class="pre">unicode</span></code> object. But <code class="docutils literal"><span class="pre">json.load</span></code>
accepts any object which is <strong>file-like</strong>, meaning that it has a
<code class="docutils literal"><span class="pre">.read()</span></code> method. This method is optimized so that very large input
streams can be handled more efficiently.</p>
<p>The <code class="docutils literal"><span class="pre">json.dumps</span></code> method directly returns a string.  But <code class="docutils literal"><span class="pre">json.dump</span></code>
requires a <em>second positional argument</em> which must be a <strong>file-like</strong>
object, something with a <code class="docutils literal"><span class="pre">.write()</span></code> method.  The value that would
normally have been returned from the method will instead be written to the
provided object.</p>
<p>Both <code class="docutils literal"><span class="pre">json.loads</span></code> and <code class="docutils literal"><span class="pre">json.dumps</span></code> can take an optional <code class="docutils literal"><span class="pre">cls</span></code> argument.
This allows you to pass a subclass of the <code class="docutils literal"><span class="pre">json.JSONEncoder</span></code> or
<code class="docutils literal"><span class="pre">json.JSONDecoder</span></code> class to be used instead of those standard objects.</p>
<p>You can create powerful, customized encoders and decoders for specialized data
types not recognized by the standard implementations:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">ComplexEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">complex</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">imag</span><span class="p">]</span>
<span class="gp">... </span>        <span class="c1"># Let the base class default method raise the TypeError</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dumps</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1j</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">ComplexEncoder</span><span class="p">)</span>
<span class="go">&#39;[2.0, 1.0]&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ComplexEncoder</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1j</span><span class="p">)</span>
<span class="go">&#39;[2.0, 1.0]&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ComplexEncoder</span><span class="p">()</span><span class="o">.</span><span class="n">iterencode</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1j</span><span class="p">))</span>
<span class="go">[&#39;[&#39;, &#39;2.0&#39;, &#39;, &#39;, &#39;1.0&#39;, &#39;]&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="rest">
<h3>REST<a class="headerlink" href="#rest" title="Permalink to this headline">¶</a></h3>
<p>SOAP was invented in part to provide completely machine-readable
interoperability through WSDL.</p>
<div class="build container">
<p>Does that really work in real life?</p>
<p>Hardly ever.</p>
<p>Another reason was to provide extensibility via custom types defined in WSDL.</p>
<p>Does that really work in real life?</p>
<p>Hardly ever.</p>
<p>So, if neither of these goals is really achieved by using SOAP, why pay all
the overhead required to use the protocol?</p>
</div>
<p>Instead, a new form for Web Services was defined, ReST.</p>
<div class="build container">
<p>It stands for <strong>Representational State Transfer</strong>.</p>
<ul class="build simple">
<li>Originally described by Roy T. Fielding (worth reading)</li>
<li>Use HTTP for what it can do</li>
<li>Read more in <a class="reference external" href="http://www.crummy.com/writing/RESTful-Web-Services/">this book</a></li>
</ul>
<div class="build container">
<p>Seriously.</p>
<p>Buy it and read (<a class="reference external" href="http://www.crummy.com/writing/RESTful-Web-Services/">http://www.crummy.com/writing/RESTful-Web-Services/</a>)</p>
</div>
</div>
</div>
<div class="section" id="rest-as-http">
<h3>REST as HTTP<a class="headerlink" href="#rest-as-http" title="Permalink to this headline">¶</a></h3>
<p>In XML-RCP/SOAP the same HTTP method is used for all calls, and the <em>endpoint</em>
is a different function. For a commenting system on a blog, this might look
something like this:</p>
<ul class="build simple">
<li>POST /getComment HTTP/1.1</li>
<li>POST /getComments HTTP/1.1</li>
<li>POST /addComment HTTP/1.1</li>
<li>POST /editComment HTTP/1.1</li>
<li>POST /deleteComment HTTP/1.1</li>
</ul>
<p>RESTful Web Services are designed to use HTTP Methods as they were intended to
be used. So the same set of functionality can be expressed like this:</p>
<ul class="build simple">
<li>GET /comment/&lt;id&gt; HTTP/1.1</li>
<li>GET /comment HTTP/1.1</li>
<li>POST /comment HTTP/1.1</li>
<li>PUT /comment/&lt;id&gt; HTTP/1.1</li>
<li>DELETE /comment/&lt;id&gt; HTTP/1.1</li>
</ul>
<p>We call this approach <strong>Resource Oriented Architecture</strong> because each function
is implemented as a different method addressing the same web-based
<strong>resource</strong>.</p>
<div class="build container">
<p>The URL represents the <em>resource</em> we are working with.</p>
<p>The HTTP Method represents the <code class="docutils literal"><span class="pre">action</span></code> to be taken.</p>
</div>
<p>Similarly, the HTTP Code returned by a RESTful service can tell us the
<code class="docutils literal"><span class="pre">result</span></code> of our action.</p>
<div class="build container">
<p>For example, in our putative commenting system, consider a POST request to
create a new comment:</p>
<div class="highlight-python"><div class="highlight"><pre>POST /comment HTTP/1.1
</pre></div>
</div>
<p>Possible responses might include:</p>
<ul class="build simple">
<li>Success: <code class="docutils literal"><span class="pre">HTTP/1.1</span> <span class="pre">201</span> <span class="pre">Created</span></code></li>
<li>Failure (unauthorized): <code class="docutils literal"><span class="pre">HTTP/1.1</span> <span class="pre">401</span> <span class="pre">Unauthorized</span></code></li>
<li>Failure (NotImplemented): <code class="docutils literal"><span class="pre">HTTP/1.1</span> <span class="pre">405</span> <span class="pre">Not</span> <span class="pre">Allowed</span></code></li>
<li>Failure (ValueError): <code class="docutils literal"><span class="pre">HTTP/1.1</span> <span class="pre">406</span> <span class="pre">Not</span> <span class="pre">Acceptable</span></code></li>
</ul>
</div>
<p>Or for a PUT request to edit an existing comment:</p>
<div class="highlight-python"><div class="highlight"><pre>PUT /comment/&lt;id&gt; HTTP/1.1
</pre></div>
</div>
<ul class="build simple">
<li>Success: <code class="docutils literal"><span class="pre">HTTP/1.1</span> <span class="pre">200</span> <span class="pre">OK</span></code></li>
<li>Failure: <code class="docutils literal"><span class="pre">HTTP/1.1</span> <span class="pre">409</span> <span class="pre">Conflict</span></code></li>
</ul>
<div class="build container">
<p>And a DELETE request to remove a comment:</p>
<div class="highlight-python"><div class="highlight"><pre>DELETE /comment/&lt;id&gt; HTTP/1.1
</pre></div>
</div>
<ul class="simple">
<li>Success: <code class="docutils literal"><span class="pre">HTTP/1.1</span> <span class="pre">204</span> <span class="pre">No</span> <span class="pre">Content</span></code></li>
</ul>
</div>
</div>
<div class="section" id="rest-and-application-state">
<h3>REST and Application State<a class="headerlink" href="#rest-and-application-state" title="Permalink to this headline">¶</a></h3>
<p>A fundamental truth of HTTP is that the protocol is <strong>stateless</strong>.</p>
<div class="build container">
<p>I&#8217;ll repeat that, for emphasis.</p>
<p class="centered"><strong>HTTP is fundamentally STATELESS</strong></p>
<p>No individual request may be assumed to know anything about any other
request.</p>
<p>If we are considering a request as a call to take some action on an
applications (our web service), then the following conclusion may be drawn:</p>
<p>All the required information representing the possible actions to take
<em>should be present in every response</em>.</p>
<p>This brings us to the fundamental axiom of RESTful Systems:</p>
<p class="centered"><strong>Hypermedia As The Engine Of Application State</strong></p>
</div>
</div>
<div class="section" id="applications-are-state-engines">
<h3>Applications are State Engines<a class="headerlink" href="#applications-are-state-engines" title="Permalink to this headline">¶</a></h3>
<p>A State Engine is like a machine. The individual parts of the machine may
be said to be in a given <em>state</em> at any one time. For example, the engine
of a car can be <em>running</em> or <em>stopped</em>. If the engine is running, the drive
shaft may be <em>engaged</em> or <em>disengaged</em> via a transmission.</p>
<p>The act of <em>starting the engine</em> moves the state of the engine from
<em>stopped</em> to <em>running</em>. The act of <em>putting the car in gear</em> moves the
drive shaft from the state of <em>disengaged</em> to <em>engaged</em>.</p>
<p>In a state engine we call these acts <strong>transitions</strong>.  They exist to move
the resources of the application between available states.</p>
<p>In HTTP, we have said that no individual request can be asserted to be aware of
the current state of the application to which it will be sent.</p>
<p>To be RESTful, then, a web service response must:</p>
<ul class="build simple">
<li>provide information about the current state of a resource</li>
<li>provide information about available transitions for that resource (URIs)</li>
<li>gracefully respond to incoming requests that reference out-of-date state
information.</li>
<li>provide all this in <em>each</em> HTTP response</li>
</ul>
</div>
</div>
<div class="section" id="wrap-up">
<h2>Wrap Up<a class="headerlink" href="#wrap-up" title="Permalink to this headline">¶</a></h2>
<div class="left container">
<p>Later, you&#8217;ll do a
<a class="reference internal" href="../assignments/tutorials/rest.html#rest-exercise"><span>walkthrough of using a RESTful web service</span></a> to extend
the app you built to scrape health inspection data yesterday.</p>
<p>As you do so, make note of how the information the web service provides you
indicates what else you can do with the data you get back.</p>
<p>Are there other services you might add to your health inspection data app?</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Extracting Data from the Web, II</a><ul>
<li><a class="reference internal" href="#web-services">Web Services</a></li>
<li><a class="reference internal" href="#early-web-services">Early Web Services</a><ul>
<li><a class="reference internal" href="#rss">RSS</a></li>
<li><a class="reference internal" href="#xml-rpc">XML-RPC</a></li>
<li><a class="reference internal" href="#soap">SOAP</a></li>
<li><a class="reference internal" href="#soap-in-python">SOAP in Python</a></li>
<li><a class="reference internal" href="#afterword">Afterword</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modern-web-services">Modern Web Services</a><ul>
<li><a class="reference internal" href="#json">JSON</a></li>
<li><a class="reference internal" href="#json-in-python">JSON in Python</a></li>
<li><a class="reference internal" href="#rest">REST</a></li>
<li><a class="reference internal" href="#rest-as-http">REST as HTTP</a></li>
<li><a class="reference internal" href="#rest-and-application-state">REST and Application State</a></li>
<li><a class="reference internal" href="#applications-are-state-engines">Applications are State Engines</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wrap-up">Wrap Up</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="jenkins.html"
                        title="previous chapter">Automate Tests with Travis CI</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="lettuce.html"
                        title="next chapter">Behavior Driven Development with Lettuce</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="lettuce.html" title="Behavior Driven Development with Lettuce"
             >next</a> |</li>
        <li class="right" >
          <a href="jenkins.html" title="Automate Tests with Travis CI"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Python Dev Accelerator 2.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >401 Python: Lecture Notes</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Cris Ewing.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
    </div>
  </body>
</html>